# ロードマップ

作成日: 2024-12-26

## 現在の状態

### 実装済み機能

#### コア機能
- [x] 5層Sankey DAG構造（府省→局→課→事業→支出先）
- [x] deck.gl による大規模グラフレンダリング（PolygonLayer + PathLayer）
- [x] Bezier曲線エッジ描画
- [x] 動的TopNフィルタリング（事業Top500、支出先Top1000）
- [x] 「その他」ノードへの集約

#### インタラクション
- [x] ホバー: BFS探索で先祖・子孫すべてをハイライト
- [x] クリック: 選択状態 + 左パネル詳細表示
- [x] ズーム/パン: マウスホイール + ドラッグ
- [x] ミニマップ: 全体の位置把握

#### レイアウト
- [x] 府省庁ごとのグループ化
- [x] レイヤーTop位置揃え
- [x] 課レイヤーの局位置順配置
- [x] 局なし課への対応（公安調査庁等）
- [x] 縦横間隔調整（0pxで隙間なし対応）

#### UI
- [x] TopN設定パネル
- [x] 間隔調整コントロール
- [x] ズームコントロール
- [x] ツールチップ

---

## Phase 2: UX改善

### 2.1 検索機能
- [ ] ノード名検索（インクリメンタル）
- [ ] 検索結果からノードへジャンプ
- [ ] 検索ヒット時のハイライト

### 2.2 URL状態同期
- [ ] ズーム/パン位置のURL保存
- [ ] 選択ノードIDのURL保存
- [ ] TopN設定のURL保存
- [ ] 共有リンク生成

### 2.3 左パネル改善
- [ ] タブ切替実装（基本情報/関連支出先/フローコンテキスト）
- [ ] 関連ノードリスト表示
- [ ] 金額詳細表示

### 2.4 ラベル表示改善
- [ ] ズームレベル連動ラベル表示
  - 俯瞰（1x）: 府省名のみ
  - 中間（2-4x）: 局名まで
  - 詳細（5x+）: 事業名まで
- [ ] ラベル衝突回避

---

## Phase 3: パフォーマンス最適化

### 3.1 レンダリング最適化
- [ ] Viewport外ノード/エッジのカリング
- [ ] LOD（Level of Detail）実装
- [ ] レイヤーキャッシング

### 3.2 データ最適化
- [ ] 遅延ロード検討（必要に応じて）
- [ ] Web Worker でのBFS計算

---

## Phase 4: 機能拡張

### 4.1 複数年度対応
- [ ] 年度切替UI
- [ ] 年度間比較表示（差分ハイライト）

### 4.2 エクスポート機能
- [ ] 選択ノードのCSVエクスポート
- [ ] スクリーンショット生成

### 4.3 埋め込み対応
- [ ] iframe埋め込み用軽量版
- [ ] 特定ノードへの直リンク

---

## Phase 5: 運用・保守

### 5.1 データ更新パイプライン
- [ ] 新年度データ取り込み自動化
- [ ] データ検証スクリプト

### 5.2 モニタリング
- [ ] パフォーマンスメトリクス収集
- [ ] エラートラッキング

---

## 優先度マトリクス

| 機能 | 影響度 | 実装難度 | 優先度 |
|------|--------|----------|--------|
| 検索機能 | 高 | 中 | **高** |
| URL状態同期 | 高 | 低 | **高** |
| ズーム連動ラベル | 中 | 中 | 中 |
| 左パネルタブ | 中 | 低 | 中 |
| Viewportカリング | 中 | 高 | 低 |
| 複数年度対応 | 低 | 高 | 低 |

---

## 技術的負債

- [ ] InfoPanel未実装（現在はプレースホルダー）
- [ ] テストコード未整備
- [ ] エラーハンドリング強化
- [ ] アクセシビリティ対応

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2024-12-26 | 初版作成 |

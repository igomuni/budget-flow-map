# 支出先データの集約による情報損失

## 発見日
2026-01-04

## 問題概要

現在のデータパイプライン（generate-graph.ts）では、**同一支出先への複数の支出が1つのノードに合算**されている。これにより、個別の支出記録が可視化から失われている。

## 具体例

### 独立行政法人日本高速道路保有・債務返済機構

CSVデータには以下の個別支出が存在:

| 事業 | 金額 | 費目 |
|------|------|------|
| 有料道路事業等 | 6,312億円 | 道路の新設・改築、スマートインターチェンジの整備 |
| 高速道路料金割引 | 775.9億円 | 高速道路の通行者の負担を軽減するための債務返済 |
| 新線調査費等 | 1,885万円 | 本州と四国を連絡する鉄道施設の管理 |
| 水資源開発事業 | 8.6万円 | 土地賃借 |
| ダム建設事業 | **20円** | 通信用ケーブル占用料 |
| ダムの維持管理事業 | **27円** | 通信用ケーブル占用料 |

**現在の可視化**: 140.9億円の1ノードとして表示（全て合算）

### 失われている情報

1. **支出の目的**: 同じ支出先でも、全く異なる目的の支出がある
   - 例: 高速道路建設（6,312億円）vs 通信ケーブル占用料（20円）

2. **支出元との関係**: 複数の事業から同一支出先への資金の流れ
   - 道路局 → 機構
   - 鉄道局 → 機構
   - 水管理・国土保全局 → 機構

3. **金額の規模感**: 20円〜6,312億円（10桁の差）が見えなくなる

## 現在のデータ構造

```
事業 ──→ 支出先（法人番号で一意化）
         └─ 金額 = 全事業からの合計
```

## 理想的なデータ構造

```
事業A ──→ 支出先への支出記録1（金額、費目、目的）
事業B ──→ 支出先への支出記録2（金額、費目、目的）
         ↓
       支出先（法人情報）
```

## 対応案

### 案1: エッジベースの可視化

現在: ノード（支出先）に金額を持たせる
改善: エッジ（事業→支出先）に金額を持たせる

**メリット**:
- 複数の資金フローを個別に表現可能
- 事業と支出先の関係が明確

**デメリット**:
- エッジ数が大幅に増加（現在のノード数と同等になる可能性）
- 描画パフォーマンスへの影響

### 案2: 支出記録の分離

支出先ノードを「法人」ではなく「支出記録」として扱う:
```
事業A → 支出記録1（機構への6,312億円）
事業B → 支出記録2（機構への20円）
```

**メリット**:
- 全ての支出が可視化される
- 20円の支出も見える

**デメリット**:
- ノード数がさらに増加
- 同一法人の支出総額を把握しにくい

### 案3: 詳細ビューでの表示

集約は維持しつつ、InfoPanelで個別支出を表示:
- ノードクリック時に全支出記録をテーブル表示
- 事業別、金額順でソート可能

**メリット**:
- 描画パフォーマンスに影響なし
- 詳細情報は失われない

**デメリット**:
- 可視化上は失われたまま
- ユーザーがクリックしないと見えない

## 推奨アプローチ

**短期**: 案3（InfoPanelでの詳細表示）を実装
- generate-graph.tsで支出記録を保持するよう修正
- InfoPanelの支出先タブで個別支出を表示

**中長期**: 案1または案2を検討
- パフォーマンス影響を測定
- ユーザーフィードバックを収集

## 関連ファイル

- `scripts/generate-graph.ts` - 支出先集約ロジック
- `src/components/InfoPanel/RecipientsTab.tsx` - 支出先詳細表示
- CSVソース: `5-1_RS_2024_支出先_支出情報.csv`

## 備考

この問題は「20円支出が見えない」という具体的な事例から発見された。
日本政府予算の金額レンジ（10桁）を考慮すると、集約による情報損失は
小規模支出の可視化という観点で本質的な課題である。

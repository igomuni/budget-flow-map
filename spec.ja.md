# budget-flow-map 仕様書（日本語版）

## 1. 概要

**budget-flow-map** は、日本政府の RSシステム（行政事業レビュー）に由来するCSVデータをもとに、
政府予算と支出の流れを **「地図のように探索できる構造」** として可視化するWebアプリケーションである。

本プロジェクトは、従来の
- ドリルダウン型UI
- Top-N による情報削減
に依存した可視化を採らず、

**全体構造を一度に提示したうえで、ズーム・パン操作によって理解を深める**
というアプローチを中核に据える。

---

## 2. 背景と課題認識

### 2.1 課題

政府予算・支出データの可視化には、以下の構造的問題がある。

- 事業数・支出先数が多く、Sankey図が破綻しやすい
- Top-N表示では「残り」が不可視化され、全体像を誤認する
- ドリルダウン前提のUIは、構造理解より操作理解を要求する
- 一度詳細に入ると、元の文脈に戻りにくい

これらはすべて、「情報量が多い」ことではなく、
**可視化モデルとインタラクション設計の不整合**に起因している。

---

## 3. 先行実装・参考事例

### 3.1 既存リポジトリ

- 旧リポジトリ  
  https://github.com/igomuni/marumie-rssystem

特徴：
- Nivo Sankey を利用
- Top-N + ドリルダウン構成
- 技術検証としては有効だったが、俯瞰性と拡張性に限界があった

本プロジェクトは、これを **思想的・技術的な前段階**として位置づける。

### 3.2 デザイン・情報設計の参考

- 米国エネルギー省（DOE）公式サイト  
  http://www.departmentof.energy/

参考点：
- 落ち着いた情報階層
- 強調しすぎない色彩設計
- 明示的なドリルダウンに依らない段階的理解

---

## 4. 設計思想（Design Principles）

### 4.1 ドリルダウンの原則廃止

- 情報は一つの連続した空間に存在する
- 「クリックして次へ進む」構造を作らない

### 4.2 地図的インタラクション

- ズーム：解像度が変わる（意味的変化を伴う）
- パン：隣接構造の探索
- フォーカス：文脈を失わず注目点を強調

Google Maps に近い認知モデルを採用する。

### 4.3 構造優先・詳細後置

- 最初に見るのは「形・流れ・密度」
- ラベルや数値は必要なときにのみ現れる

### 4.4 スケーラビリティ前提

- 数千〜数万ノードを例外ではなく前提とする
- 小規模データ向け最適化は行わない

---

## 5. データモデル

### 5.1 入力データ

- RSシステム由来CSV
- 主な要素：
  - 予算区分
  - 事業
  - 支出先
  - 金額
  - 年度

### 5.2 内部表現

- 有向重み付きグラフ（DAGに近い構造）
- ノード：
  - `id`
  - `type`（予算 / 事業 / 支出先）
  - `amount`
- エッジ：
  - `source`
  - `target`
  - `value`

事前集約・クラスタリングは許容するが、
**元の構成要素の存在を消してはならない**。

---

## 6. 可視化アーキテクチャ

### 6.1 レンダリング戦略

| レイヤ | 技術 | 役割 |
|------|------|------|
| 基本描画 | WebGL / Canvas | 大量ノード・エッジ描画 |
| インタラクション | SVG / HTML Overlay | ホバー、フォーカス、ラベル |
| UI | React | 状態管理・レイアウト |

### 6.2 レイアウト方針

- Flow-aware / Force-based レイアウト
- 重視点：
  - 流れの連続性
  - クラスタの近接関係
  - 密度そのものを情報として扱う

操作によってレイアウトが大きく変わらない
**メンタルマップ保持**を必須条件とする。

---

## 7. インタラクション設計

### 必須
- ズーム（幾何＋意味）
- パン
- ホバーによる強調表示
- フロー経路のハイライト

### 任意
- 検索・位置特定
- 年度切り替え

### 明示的に行わないこと
- ステップ型ドリルダウン
- モーダル多用
- ページ分割型探索

---

## 8. 技術スタック（想定）

### フロントエンド
- React
- TypeScript
- Zustand 等の軽量ステート管理

### 可視化候補
- D3（低レベル制御）
- deck.gl
- PixiJS
- regl ベースの WebGL 実装

※ Nivo は採用しない。

### 開発基盤
- Vite
- ESLint / Prettier
- CSV ストリーミングパース対応

---

## 9. 非目標（Non-Goals）

- 会計実務向けUI
- モバイル最適化（タブレットまで）
- ストーリーテリング主導の解説UI

---

## 10. プロジェクト哲学

本プロジェクトは、
政府予算を「読むもの」ではなく
**「歩き回って把握する構造」**として扱う。

理解は、操作手順ではなく
空間的な慣れによって生まれる。
